<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Angela</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/style.css') }}">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<body>
  <!-- partial:index.partial.html -->
  <section class="msger">
    <header class="msger-header">
      <div class="msger-header-title">
        Angela
      </div>
    </header>

    <main class="msger-chat">
      <div class="msg left-msg">
        <div class="msg-img" style="background-image: url(https://image.flaticon.com/icons/svg/327/327779.svg)"></div>

        <div class="msg-bubble">
          <div class="msg-info">
            <div class="msg-info-name">Angela</div>
            <div class="msg-info-time">12:45</div>
          </div>

          <div class="msg-text">
           Ciao sono Angela, come posso aiutarti?
          </div>
        </div>
      </div>

    </main>

    <form class="msger-inputarea">
      <input type="text" class="msger-input" id="textInput" placeholder="Enter your message...">
      <button type="submit" class="msger-send-btn">Send</button>
    </form>
  </section>
  <!-- partial -->
  <script src='https://use.fontawesome.com/releases/v5.0.13/js/all.js'></script>
  <script>

    // le tre costanti di stile prese dal css
    const msgerForm = get(".msger-inputarea");
    const msgerInput = get(".msger-input");
    const msgerChat = get(".msger-chat");


    // Icons made by Freepik from www.flaticon.com + più il nome del bot, il mio nome etc...
    const BOT_IMG = "https://image.flaticon.com/icons/svg/327/327779.svg";
    const PERSON_IMG = "https://image.flaticon.com/icons/svg/145/145867.svg";
    const BOT_NAME = "Angela";
    const PERSON_NAME = "You";

    //se sti triggera l'evento submit,
    msgerForm.addEventListener("submit", event => {
      event.preventDefault();

      const msgText = msgerInput.value;
      // se non è un messaggio ritorna
      if (!msgText) return;

      // altrimenti fai comparire un messaggio con questa funzione
      appendMessage(PERSON_NAME, PERSON_IMG, "right", msgText);
      msgerInput.value = "";
      // attiva la risposta del bot
      botResponse(msgText);
    });

    function appendMessage(name, img, side, text) {
      //   Simple solution for small apps
      const msgHTML = `
<div class="msg ${side}-msg">
  <div class="msg-img" style="background-image: url(${img})"></div>
  <div class="msg-bubble">
    <div class="msg-info">
      <div class="msg-info-name">${name}</div>
      <div class="msg-info-time">${formatDate(new Date())}</div>
    </div>
    <div class="msg-text">${text}</div>
  </div>
</div>
`;

      msgerChat.insertAdjacentHTML("beforeend", msgHTML);
      msgerChat.scrollTop += 500;
    }

    function appendMessage2(name, img, side) {
      //   Simple solution for small apps
      const msgHTML = `
<div class="msg ${side}-msg">
  <div class="msg-img" style="background-image: url(${img})"></div>
  <div class="msg-bubble">
    <div class="msg-info">
      <div class="msg-info-name">${name}</div>
      <div class="msg-info-time">${formatDate(new Date())}</div>
    </div>
    <div class="msg-bubble"><img src="/static/images/images/ferdinando.jpg" class="ferdinando" ></div>
  </div>
</div>
`;

      msgerChat.insertAdjacentHTML("beforeend", msgHTML);
      msgerChat.scrollTop += 500;
    }

 function appendMessage3(name, img, side) {
      //   Simple solution for small apps
      const msgHTML = `
<div class="msg ${side}-msg">
  <div class="msg-img" style="background-image: url(${img})"></div>
  <div class="msg-bubble">
    <div class="msg-info">
      <div class="msg-info-name">${name}</div>
      <div class="msg-info-time">${formatDate(new Date())}</div>
    </div>
    <div class="msg-bubble"><img src="/static/images/images/cavalli.jpg" class="test" ></div>
  </div>
</div>
`;

      msgerChat.insertAdjacentHTML("beforeend", msgHTML);
      msgerChat.scrollTop += 500;
    }

    function botResponse(rawText) {

      // Bot Response
      $.get("/get", { msg: rawText }).done(function (data) {
        console.log(rawText);
        console.log(data);
        const msgText = data;
        if ((msgText == "Ferdinando IV di Borbone fu Re di Napoli e di Sicilia dal 1759 al 1816 (a parte il periodo napoleonico tra il 1806 e il 1815) e, dopo l’unificazione dei due regni a seguito del Congresso di Vienna, fu Re delle Due Sicilie fino al 1825. Fu il primo regnante della casa di Borbone a nascere nel suo regno, a Napoli. A lui si deve la costruzione della Reggia di Carditello.")) {
          appendMessage(BOT_NAME, BOT_IMG, "left", msgText);
          appendMessage2(BOT_NAME, BOT_IMG, "left");
        }
        else if ((msgText == "Al Real Sito di Carditello potrete ammirare i cavalli Persano, una razza pregiata di cavalli nati da un incrocio tra stalloni turchi e fattrici locali per volontà di Carlo di Borbone.  L’allevamento dei cavalli Persano (dal nome del Sito Reale di Persano, residenza borbonica nel comune di Serre, SA) era finalizzato alla costituzione di una cavalleria reale di alto prestigio. Tali esemplari si contraddistinguono per l’eleganza, la destrezza e la velocità. A inizio 1700, Carditello fu il luogo scelto per il perfezionamento della razza pregiata dei Persano, a tal fine Carlo di Borbone procedette all’acquisto dei terreni, su cui poi sorse la Reggia.  Ferdinando IV predispose per gli animali ricoveri e scuderie, oltre che un ampio galoppatoio, il più grande tra quelli all’interno di una residenza reale.  Il cavallo Persano rappresenta tutt’oggi uno dei simboli più conosciuti in tutto il mondo, grazie ad Enzo Ferrari che lo riprese per il famoso marchio che assegnò alla prestigiosa autovettura.   “Ferrari, metta sulle sue macchine il cavallino rampante del mio figliolo. Le porterà fortuna”. Così la contessa Paolina Baracca, la mamma del celebre aviatore caduto sul Montello, disse una volta a Enzo Ferrari.  Dopo la morte dell’aviatore, la madre di Francesco consigliò alla famiglia Ferrari di adottare come stemma per la nuova vettura quel “cavallino rampante”, e fu così che nacque uno degli stemmi più famosi al mondo, da sempre simbolo di velocità, eleganza, prestigio e bellezza")) {
          appendMessage(BOT_NAME, BOT_IMG, "left", msgText);
          appendMessage3(BOT_NAME, BOT_IMG, "left");
        }
        else {
          appendMessage(BOT_NAME, BOT_IMG, "left", msgText);
        }
      });

    }

    // Utils
    function get(selector, root = document) {
      return root.querySelector(selector);
    }

    function formatDate(date) {
      const h = "0" + date.getHours();
      const m = "0" + date.getMinutes();

      return `${h.slice(-2)}:${m.slice(-2)}`;
    }


  </script>

</body>

</html>
